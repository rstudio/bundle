<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Serialize Model Objects with a Consistent Interface • bundle</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Serialize Model Objects with a Consistent Interface">
<meta name="description" content="Typically, models in R exist in memory and can be saved via regular R serialization. However, some models store information in locations that cannot be saved using R serialization alone. The goal of bundle is to provide a common interface to capture this information, situate it within a portable object, and restore it for use in new settings.">
<meta property="og:description" content="Typically, models in R exist in memory and can be saved via regular R serialization. However, some models store information in locations that cannot be saved using R serialization alone. The goal of bundle is to provide a common interface to capture this information, situate it within a portable object, and restore it for use in new settings.">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">bundle</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/bundle.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/bundle/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="bundle">bundle<a class="anchor" aria-label="anchor" href="#bundle"></a>
</h1></div>
<!-- badges: start -->

<p>Typically, models in R exist in memory and can be saved as <code>.rds</code> files. However, some models store information in locations that cannot be saved using <code><a href="https://rdrr.io/r/base/save.html" class="external-link">save()</a></code> or <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> directly. The goal of bundle is to provide a common interface to capture this information, situate it within a portable object, and restore it for use in new settings.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of bundle from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"bundle"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"rstudio/bundle"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>We often imagine a trained model as a somewhat “standalone” R object—given some new data, the R object can generate predictions on its own. In reality, some types of model objects also make use of <em>references</em> to generate predictions. A reference is a piece of information that a model object refers to that isn’t part of the object itself; this could be anything from a connection with a server to an internal function in the package used to train the model. When we call <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>, model objects know where to look to retrieve that data, but saving model objects can sometimes disrupt those references. Thus, if we want to train a model, save it, re-load it into memory in a production setting, and generate predictions with it, we may run into issues because those references do not exist in the new computational environment.</p>
<p>We need some way to preserve access to those references. The bundle package provides a consistent interface for <em>bundling</em> model objects with their references so that they can be safely saved and re-loaded in production:</p>
<p><img src="reference/figures/diagram_04.png" alt="A diagram showing a rectangle, labeled model object, and another rectangle, labeled predictions. The two are connected by an arrow from model object to predictions, with the label 'predict'. There are two boxes labeled reference, connected to the arrow labeled predict with dotted arrows, to show that, most of the time, we don't need to think about including them in our workflow. There are two boxes, labeled R Session number one, and R session number two. In focus is the arrow from the model object, in R Session number one, to a model object in R session number two. This arrow connecting the model object in R session one and the model object in R session two is connected by a verb called bundle. The bundle function outputs an object called a bundle." width="100%"></p>
<p>For more on this diagram, see the <a href="https://rstudio.github.io/bundle/articles/bundle.html">main bundle vignette</a>.</p>
<p>When you’re ready to save your model, <code><a href="reference/bundle.html">bundle()</a></code> it first. Once you’ve loaded it in a new setting, <code><a href="reference/bundle.html">unbundle()</a></code> it!</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>The bundle package prepares model objects so that they can be effectively saved and re-loaded for use in new R sessions. To demonstrate using bundle, we will train a boosted tree model using <a href="https://xgboost.readthedocs.io/" class="external-link">XGBoost</a>, bundle it, and then pass the bundle into another R session to generate predictions on new data.</p>
<p>First, load needed packages:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/bundle" class="external-link">bundle</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://callr.r-lib.org" class="external-link">callr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://waldo.r-lib.org" class="external-link">waldo</a></span><span class="op">)</span></span></code></pre></div>
<p>Fit the boosted tree model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit an boosted tree with xgboost via parsnip</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://parsnip.tidymodels.org/reference/boost_tree.html" class="external-link">boost_tree</a></span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">5</span>, mtry <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ##### xgb.Booster</span></span>
<span><span class="co">#&gt; raw: 8.1 Kb </span></span>
<span><span class="co">#&gt; call:</span></span>
<span><span class="co">#&gt;   xgboost::xgb.train(params = list(eta = 0.3, max_depth = 6, gamma = 0, </span></span>
<span><span class="co">#&gt;     colsample_bytree = 1, colsample_bynode = 0.3, min_child_weight = 1, </span></span>
<span><span class="co">#&gt;     subsample = 1), data = x$data, nrounds = 5, watchlist = x$watchlist, </span></span>
<span><span class="co">#&gt;     verbose = 0, nthread = 1, objective = "reg:squarederror")</span></span>
<span><span class="co">#&gt; params (as set within xgb.train):</span></span>
<span><span class="co">#&gt;   eta = "0.3", max_depth = "6", gamma = "0", colsample_bytree = "1", colsample_bynode = "0.3", min_child_weight = "1", subsample = "1", nthread = "1", objective = "reg:squarederror", validate_parameters = "TRUE"</span></span>
<span><span class="co">#&gt; xgb.attributes:</span></span>
<span><span class="co">#&gt;   niter</span></span>
<span><span class="co">#&gt; callbacks:</span></span>
<span><span class="co">#&gt;   cb.evaluation.log()</span></span>
<span><span class="co">#&gt; # of features: 10 </span></span>
<span><span class="co">#&gt; niter: 5</span></span>
<span><span class="co">#&gt; nfeatures : 10 </span></span>
<span><span class="co">#&gt; evaluation_log:</span></span>
<span><span class="co">#&gt;   iter training_rmse</span></span>
<span><span class="co">#&gt;  &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;      1     14.631798</span></span>
<span><span class="co">#&gt;      2     10.896629</span></span>
<span><span class="co">#&gt;      3      8.188981</span></span>
<span><span class="co">#&gt;      4      6.173644</span></span>
<span><span class="co">#&gt;      5      4.707690</span></span></code></pre></div>
<p>Note that simply saving and loading the model results in changes to the fitted model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">temp_file</span><span class="op">)</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html" class="external-link">compare</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod2</span>, ignore_formula_env <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `old$fit$handle` is &lt;pointer: 0x11c1707c0&gt;</span></span>
<span><span class="co">#&gt; `new$fit$handle` is &lt;pointer: 0x0&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; `old$fit$handle` is attr(,"class")</span></span>
<span><span class="co">#&gt; `new$fit$handle` is attr(,"class")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; `old$fit$handle` is [1] "xgb.Booster.handle"</span></span>
<span><span class="co">#&gt; `new$fit$handle` is [1] "xgb.Booster.handle"</span></span></code></pre></div>
<p>Saving and reloading <code>mod2</code> didn’t preserve XGBoost’s reference to its <code>pointer</code>, which may result in failures later in the modeling process.</p>
<p>We thus need to prepare the fitted model to be saved before passing it to another R session. We can do so by bundling it:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># bundle the model</span></span>
<span><span class="va">bundled_mod</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/bundle.html">bundle</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bundled_mod</span></span>
<span><span class="co">#&gt; bundled model_fit object.</span></span></code></pre></div>
<p>Passing the model to another R session and generating predictions on new data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the model in a fresh R session and predict on new data</span></span>
<span><span class="fu"><a href="https://callr.r-lib.org/reference/r.html" class="external-link">r</a></span><span class="op">(</span></span>
<span>  func <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">bundled_mod</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/bundle" class="external-link">bundle</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">unbundled_mod</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu"><a href="reference/bundle.html">unbundle</a></span><span class="op">(</span><span class="va">bundled_mod</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">unbundled_mod</span>, new_data <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span><span class="fl">26</span><span class="op">:</span><span class="fl">32</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    bundled_mod <span class="op">=</span> <span class="va">bundled_mod</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 1</span></span>
<span><span class="co">#&gt;   .pred</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  22.3</span></span>
<span><span class="co">#&gt; 2  22.3</span></span>
<span><span class="co">#&gt; 3  20.4</span></span>
<span><span class="co">#&gt; 4  14.5</span></span>
<span><span class="co">#&gt; 5  14.5</span></span>
<span><span class="co">#&gt; 6  12.1</span></span>
<span><span class="co">#&gt; 7  17.0</span></span></code></pre></div>
<p>For a more in-depth demonstration of the package, see the <a href="https://rstudio.github.io/bundle/articles/bundle.html">main vignette</a> with <code><a href="articles/bundle.html">vignette("bundle")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>This project is released with a <a href="https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
<ul>
<li><p>For questions and discussions about our packages, modeling, and machine learning, please <a href="https://forum.posit.co/new-topic?category_id=15&amp;tags=question" class="external-link">post on RStudio Community</a>.</p></li>
<li><p>If you think you have encountered a bug, please <a href="https://github.com/rstudio/bundle/issues" class="external-link">submit an issue</a>.</p></li>
<li><p>Either way, learn how to create and share a <a href="https://reprex.tidyverse.org/articles/articles/learn-reprex.html" class="external-link">reprex</a> (a minimal, reproducible example), to clearly communicate about your code.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=bundle" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/rstudio/bundle/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/rstudio/bundle/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li><a href="SUPPORT.html">Getting help</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bundle</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://juliasilge.com/" class="external-link">Julia Silge</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3671-836X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Simon Couch <br><small class="roles"> Author </small>  </li>
<li>Qiushi Yan <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://github.com/topepo" class="external-link">Max Kuhn</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/rstudio/bundle/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/rstudio/bundle/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=bundle" class="external-link"><img src="https://www.r-pkg.org/badges/version/bundle" alt="CRAN status"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://app.codecov.io/gh/rstudio/bundle?branch=main" class="external-link"><img src="https://codecov.io/gh/rstudio/bundle/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://juliasilge.com/" class="external-link">Julia Silge</a>, Simon Couch, Qiushi Yan, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
